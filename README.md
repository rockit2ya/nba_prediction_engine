# üèÄ NBA Predictive Analytics Engine (v3.0)

This README covers the features, technical architecture, mathematical modeling, and deployment steps for the NBA Prediction Engine (engine).

### **Overview**

The **NBA Pro Engine (V3)** is a situational analytics tool designed for high-fidelity point spread predictions. Unlike basic models that use season averages, this engine prioritizes "Current Form" and "Immediate Context" to find market inefficiencies. It leverages the **NBA's Four-Factors** and advanced efficiency ratings to calculate a "Fair Line" (Projected Spread) for daily matchups. Unlike basic models that rely on season averages, this engine incorporates real-time injury scraping, fatigue adjustments (Back-to-Backs), and dynamic home-court weighting.

### **Key Pro Features**

- **Situational Modeling:** Factors in Back-to-Back (B2B) fatigue and dynamic Home Court Advantage (HCA).
- **Bayesian Star Tax:** Uses individual "On-Off" metrics weighted by official injury status (OUT, GTD, Doubtful).
- **Live Scoreboard V3:** High-reliability connection to real-time game schedules and scores.
- **Optimized Performance:** Multi-threaded API calls and persistent sessions for sub-2-second analysis.
- **Kelly Criterion Integration:** Calculates conservative bankroll risk for every edge found.
- **Emergency Fallback:** Continues working even if the NBA API is down using baseline league data.

### **Project Structure & File Guide**

| File/Folder                      | Purpose                                                                                                                                                                        |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `nba_engine_ui.py`               | Main command-line interface for running the NBA analytics engine and interacting with users. Handles all user input, analysis, and logging. Supports graceful Ctrl+C exit.     |
| `nba_analytics.py`               | Core analytics logic and spread prediction. Bayesian Star Tax, late-scratch detection, fatigue adjustments. Reads from pre-fetched cache files.                                |
| `nba_data_fetcher_advanced.py`   | Selenium-based NBA.com advanced stats scraper. Used as a fallback if `nba_api` fails.                                                                                          |
| `injury_scraper.py`              | Scrapes CBS Sports for NBA injury data and caches to `nba_injuries.csv`.                                                                                                       |
| `nba_lineup_and_news_monitor.py` | Scrapes ESPN for NBA lineups/injuries and fetches breaking news via ESPN RSS feed.                                                                                              |
| `rest_penalty_scraper.py`        | Scrapes and caches rest/fatigue penalty data per team to `nba_rest_penalty_cache.csv`.                                                                                         |
| `cache_nba_news.py`              | Fetches ESPN RSS news feed and caches to `nba_news_cache.json` for offline use.                                                                                                |
| `post_mortem.py`                 | Post-game analysis tool for reviewing bet outcomes and model accuracy.                                                                                                         |
| `fetch_all_nba_data.sh`          | Bash script to run all data fetchers/scrapers and verify all caches are up to date.                                                                                            |
| `fetch_all_nba_data.log`         | Log file generated by `fetch_all_nba_data.sh` with details of each fetcher run.                                                                                                |
| `nba_stats_cache.json`           | Cached NBA team advanced stats (auto-generated/updated by fetchers and engine).                                                                                                |
| `nba_injuries.csv`               | Cached injury report data (auto-generated by `injury_scraper.py`).                                                                                                             |
| `nba_news_cache.json`            | Cached NBA news items from ESPN RSS (auto-generated by `cache_nba_news.py`).                                                                                                   |
| `nba_rest_penalty_cache.csv`     | Cached rest/fatigue penalty data per team (auto-generated by `rest_penalty_scraper.py`).                                                                                       |
| `game_schedule.csv`              | Local schedule data for rest/fatigue calculations.                                                                                                                             |
| `bet_tracker_YYYY-MM-DD.csv`     | Daily log of all bets, fair lines, edges, and Kelly calculations.                                                                                                              |
| `requirements.txt`               | Python dependencies for the project.                                                                                                                                           |
| `API_STATUS.md`                  | Documentation of current API status, troubleshooting, and fallback behavior.                                                                                                   |
| `BETTING_GUIDE.md`               | Guide to using the engine for betting, including manual steps and best practices.                                                                                               |
| `README.md`                      | This file.                                                                                                                                                                     |

---

## üö¶ Recommended User Workflow (2026)

Follow these steps to get the most out of the NBA Prediction Engine:

1. **Update and Fetch Real-Time Data**
   - Run the engine (`python nba_engine_ui.py`) to automatically pull the latest advanced stats, injury reports (from ESPN), and breaking news (via RSS).
   - For a manual refresh, run `bash fetch_all_nba_data.sh` to update all caches.

2. **Analyze Games and Generate Recommendations**
   - The UI displays today‚Äôs NBA schedule.
   - For each game, input the market line when prompted.
   - The engine calculates the fair line, edge, and confidence, factoring in:
     - Advanced stats
     - Real-time injuries/lineups (ESPN)
     - Late-breaking news (RSS)
     - Home/away splits, rest, and coaching changes

3. **Automated Flagging**
   - If late-breaking lineup/injury news is detected, the UI will alert you to double-check before betting.
   - Only games with edge ‚â• 5 and HIGH confidence are recommended as ‚ÄúSTRONG SIGNAL‚Äù bets.

4. **Logging and Tracking**
   - Each analysis is logged to a date-stamped CSV for post-mortem review.
   - Use `nba_score_updater.py` to update the tracker with actual results after games finish.

5. **Post-Analysis**
   - Use `post_mortem.py` to review bet outcomes, margins, and model performance, including injury impact.

6. **Continuous Improvement**
   - Refine model features, thresholds, and data sources as needed.
   - Expand dataset and automate loss pattern analysis for ongoing model tuning.

This workflow ensures your predictions are always based on the most current data, with built-in checks for late-breaking news and injuries, and a clear audit trail for every bet.

---

## üß∞ Optional Utility Tools

These scripts provide additional analysis, data checks, and manual overrides for advanced users:

- **edge_threshold_analysis.py**
  - Analyze win rates at different edge thresholds to tune your model‚Äôs recommendation cutoff.
  - Usage: `python edge_threshold_analysis.py`

- **injury_scraper.py**
  - Manually scrape and save the latest NBA injury data from CBS Sports for custom analysis or troubleshooting.
  - Usage: `python injury_scraper.py`

- **nba_lineup_and_news_monitor.py**
  - Scrape ESPN for real-time lineups/injuries and fetch NBA news headlines via RSS. Useful for monitoring late scratches and breaking news.
  - Usage: `python nba_lineup_and_news_monitor.py`

- **late_scratch_checker.py**
  - Quickly check for last-minute injury or scratch news from NBA/ESPN before placing bets.
  - Usage: `python late_scratch_checker.py`

These tools are optional but recommended for power users who want deeper insight, custom data, or extra validation before betting.

---

## üõ†Ô∏è VS Code Installation & Setup (macOS)

### **Step 1: Open Your Project**

1. Launch **Visual Studio Code**.
2. Go to `File > Open Folder...` and select the folder containing your `.py` files.

### **Step 2: Set Up a Virtual Environment (Recommended)**

This keeps your project libraries isolated and prevents "Module Not Found" errors.

1. Open the integrated terminal in VS Code (`Terminal > New Terminal`).
2. Type the following commands:

```bash
python3 -m venv .venv
source .venv/bin/activate

```

3. You should now see `(.venv)` at the start of your terminal prompt.

### **Step 3: Install Dependencies**

Run this command in your VS Code terminal to install dependencies:

```bash
pip install -r requirements.txt

```

### **Step 4: Select the Python Interpreter**

1. Press `Cmd + Shift + P` and type **"Python: Select Interpreter"**.
2. Choose the one that starts with `./.venv/bin/python`. This ensures VS Code uses the libraries you just installed.

### **Step 5: Run the Engine**

1. Open `nba_engine_ui.py` in the editor.
2. Click the **"Play"** button in the top-right corner, or type this in the terminal:

```bash
python nba_engine_ui.py

```

### **VS Code YouTube Tutorials**

- [How to Set Up Python Development in VS Code on Mac](https://www.youtube.com/watch?v=4CJHjqZfH7A) - This video provides a clear walkthrough for setting up a virtual environment and running Python scripts on macOS, which is essential for getting your NBA engine running smoothly.
- [How to Run Python in Visual Studio Code on Windows 10/11](http://www.youtube.com/watch?v=mIVB-SNycKI) - Step-by-step guide you on how to run Python in Visual Studio Code on Windows 10/11 + Python for Python Developers on Windows 10/11 OS.

---

## üèÅ Pro Troubleshooting

- **Slow Data:** The first run creates the cache. Subsequent runs will be nearly instant.
- **Connection Error:** If the NBA blocks your Wi-Fi, toggle your iPhone's **Airplane Mode** for 5 seconds to reset your hotspot's IP address.
- **Missing Data:** If the CSV isn't updating, ensure you have "Write" permissions for the folder you opened in VS Code.

---

## üß† The "Nitty-Gritty": How the Engine is Modeled

The model operates on the principle that NBA games are won by possession efficiency. It translates advanced ratings into a point spread using the following multi-layer logic:

### 1. The Core Efficiency Formula

We calculate the expected point differential per 100 possessions by cross-referencing offensive and defensive ratings over a **rolling 10-game window**:

$$Raw\ Diff = (OffRtg_{home} - DefRtg_{away}) - (OffRtg_{away} - DefRtg_{home})$$

This value is then normalized to the projected pace of the game:

$$Points_{spread} = Raw\ Diff \times \left( \frac{Pace_{avg}}{100} \right)$$

### 2. Situational Adjustments (The "Edge")

To move beyond a 50% accuracy rate, the engine applies three situational layers:

- **Fatigue Adjuster (B2B):** Detects if a team played the previous night. A **-2.5 point penalty** is applied to tired teams to account for drops in rebounding and defensive intensity.
- **Dynamic Home Court (HCA):** Instead of a flat +3.0, the engine calculates a team-specific HCA based on their season-long Home vs. Road Net Rating.
- **Star Tax (Injury Impact):** Scrapes live injury reports. If a star is out, the engine looks up their individual `On-Off Plus/Minus` and subtracts that value from the team's total power rating.

### 3. The Sanity Check (Volatility Filter)

If the **Calculated Edge** (Difference between Engine Line and Market Line) exceeds **11.0 points**, the engine flags the game as high-volatility. This usually indicates a market-moving event (like a trade or late scratch) that the math has detected but requires human verification.

---

### üìâ Mathematical Modeling Section

The engine uses a series of possession-based linear equations to derive the fair value of a matchup.

#### 1. Efficiency Differential ()

We first calculate the net efficiency margin by comparing how each team's offense performs against the opponent's defense:

$$Raw\ Diff = (OffRtg_{home} - DefRtg_{away}) - (OffRtg_{away} - DefRtg_{home})$$

#### 2. Pace Normalization

Since is calculated per 100 possessions, we must scale it to the game's projected (the total number of possessions for both teams):

$$Points_{spread} = Raw\ Diff \times \left( \frac{Pace_{avg}}{100} \right)$$

#### 3. Situational Final Line ()

The final projected spread incorporates the Dynamic Home Court Advantage (), the Fatigue Adjustment (), and the Star Tax ():

$$Fair\ Line = Points_{spread} + HCA + \sum Rest + \sum Injury$$

---

## üõ†Ô∏è Extreme Edge

Those "Extreme Edge" alerts are exactly what you want to see‚Äîit means the engine is doing its job by flagging games where the math significantly diverges from the Vegas line.

For the **February 8, 2026** slate you just ran, your engine is reacting to a massive amount of "noise" in the injury reports. Here is the breakdown of why those specific games triggered alerts:

### üîç Breakdown of the "Extreme" Edges

| Game              | Edge          | Why the Alert Triggered                                                                                                                                                                                                                                                             |
| ----------------- | ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **G1: NYK @ BOS** | **12.59 pts** | **The Tatum Factor:** Jayson Tatum is officially **OUT** (Achilles). Your engine's "Star Tax" likely hammered the Celtics' rating, while the market is still giving them a -3.5 favorite status based on their depth.                                                               |
| **G3: IND @ TOR** | **16.24 pts** | **The Zubac/Haliburton Void:** This is a "chaos" game. The Pacers are missing Tyrese Haliburton and Ivica Zubac, while Toronto has several "Questionables." The 16-point gap suggests the market thinks Toronto is healthy, while your engine sees two depleted rosters.            |
| **G4: LAC @ MIN** | **10.6 pts**  | **Clippers Trade/Injury Flux:** The Clippers are listed with several "Out" players (Garland, Mathurin, Jackson) due to pending trades and injuries. Your engine likes the Clippers +9.5 because it sees Minnesota's Poeltl being out as a bigger net-negative than the market does. |

---

### üõ†Ô∏è How to Handle these Alerts

When you see an edge over 10 points, **don't just bet the "Recommended Side" immediately.** Use the "Human in the Loop" method:

1. **Check the "Questionables":** For G1, the Knicks have **Karl-Anthony Towns, Josh Hart, and OG Anunoby** all listed as Questionable. If all three play, your "Recommended Side" (Knicks) is a lock. If all three sit, that 12.59-point edge might actually vanish or flip.
2. **Verify the Scraper:** Since the scraper pulls from CBS, sometimes it misses a "Game Time Decision" (GTD) that was just announced on Twitter/X.
3. **The "Trap Line" Rule:** If your engine says the Knicks should be favored by 9, but Vegas has them as +3.5, ask yourself: _"What does Vegas know that my 10-game rolling average doesn't?"_ (Usually, it's a specific player matchup or a "revenge game" narrative).

---
